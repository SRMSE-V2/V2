$(document).ready(function(){
window.leftauto=-1;
window.firstresize=true;
window.strlen=0;
    $("#search").autocomplete({
                  
            source: "/cgi-bin/getWords.py",
            minLength: 1,
            autoFocus: true,
            appendTo:".search_div",
            html:true,
            open: function(event, ui) {
                $(".ui-helper-hidden-accessible").remove();
                    $(this).autocomplete("widget").css({
                "width": ($("#search").width() + "px")
            });
if(window.leftauto!==-1){
            $(".ui-autocomplete").css("postion","relative").css("left",window.leftauto+"px");
$(".ui-autocomplete").css("width","");
$(".ui-autocomplete >li").css("width","100%");
$(".ui-autocomplete >li>a").css("white-space","nowrap");//,($("#search").width()-window.strlen)+"px");
}
            event.preventDefault();
        },
            focus: function (event, ui) {
              
               
              
if(window.originalquery){
 console.log(ui); 
              if(window.originalquery!=""){
              console.log(ui); 
event.preventDefault();
var arr=window.originalquery.split(" ");
		var temp=arr.slice(0,arr.length-1).join(" ");
              $("#search").val(temp+" "+ui["item"]["value"]);
              
              }
             }
        },
response:function(event,ui){
console.log(ui);
if(ui.content[0]["resize"]==="true"){
window.originalquery=$("#search").val().trim();
	if(window.firstresize){
		window.defaultleft=parseInt($("#search").offset().left);
		window.firstresize=false;
		var pos=$("#search").val().length*parseInt($("#search").css("font-size").replace("px",""));
window.strlen=parseInt(pos)*0.8;
		window.leftauto=(window.defaultleft+parseInt(pos))*0.8;
	}
	else{
		var pos=$("#search").val().length*parseInt($("#search").css("font-size").replace("px",""));
window.strlen=parseInt(pos)*0.8;
		window.leftauto=(window.defaultleft+parseInt(pos))*0.8;
	}


}
else{
window.originalquery="";
window.leftauto=-1;
}
},
            select:function (e, ui) {
            
               e.preventDefault();
               if(e.keyCode===13){
                    var query=$("#search").val().trim();
                    console.log("Query submitted");
                    console.log(query);
                    window.location="/cgi-bin/search.py?q="+query;
               }
               
               else{
                  var query=ui.item.value;
                    console.log("Query submitted");
                    console.log(ui.item.value);
                    window.location="/cgi-bin/search.py?q="+ui.item.value;
               }
                    
               
              
        }
        ,delay:300
        
                               
                               

    });
    $("#search").on("keypress",function(event){
    console.log($("#search").val());
    if((event.keyCode===13) && ($("#search").val()!=="")){
            var query=$("#search").val().trim();
            console.log("Query submitted");
            console.log(query);
            window.location="/cgi-bin/search.py?q="+query;
    
    }
    
    });
    $("#search_btn").on("click",function(){
        if($("#search").val().trim()!==""){
            var query=$("#search").val().trim();
            console.log("Query submitted");
            console.log(query);
            window.location="/cgi-bin/search.py?q="+query;
        }
    });
    
    
    $(window).on("resize",function(){
    
    //hides autocomplete dropdown on screen resize
    $(".ui-autocomplete").hide();
    window.leftauto=-1;
window.firstresize=true;
window.strlen=0;
    
    });
window.connect=function(data_pass){
            var data = data_pass;
            $.ajax({
                type: 'get',
                url:'/cgi-bin/locentric.py',
                data: data,
                success : function(response){
                    window.locentric = response;
                    console.log(response);
                }
            });
        };
window.loadLocation=function(){
if(document.cookie.indexOf("latitude")>=0){
var obj={};
var arr=document.cookie.split(";");
$.each(arr,function(index,element){
var t=element.split("=");
obj[t[0].trim()]=t[1].trim();
});
window.connect({"lat":obj["latitude"], "long":obj["longitude"]});

}
else{
$.getScript("/ver1/js/location_centric.js");
}

};
   window.loadLocation();
    
});
