0===$("#wiki").length&&$.ajax({async:!0,url:"/mediawiki/api.php?action=parse&page="+window.wikiTitle+"&prop=text&section=0&format=json&disablepp&redirects",dataType:"text",type:"GET"}).done(function(e){function i(e,i){for(var a=[],t=e.indexOf(i);-1!==t;t=e.indexOf(i,t+1))a.push(t)
return a}var a=JSON.parse(e),t=a.parse.text["*"].replace(/\n/g,"")
if(t.indexOf("infobox")>=0){var p=i(t,"</table>"),r=p.length,n=(i(t,"<table"),t.substr(0,p[r-1]).replace(/\/mediawiki\/index.php\//g,"http://en.wikipedia.org/wiki/").replace(/<a/g,'<a target="_blank"')),l=$(n),d=$("<div></div>")
d.append(l),l=d,$.each(l.find("a"),function(){if($(this).attr("href")&&$(this).attr("href").indexOf("File")>=0){$(this).text("")
var e=$("<img>"),i=$(this).attr("href").split("/")
e.attr("src","http://en.wikipedia.org/wiki/en:Special:Filepath/"+i[i.length-1].replace("File:","")+"?width=140"),$(this).append(e)}})
var s=t.replace(t.substr(0,p[r-1]),"").replace(/&lt;/g,"<").replace(/&gt;/g,">"),o=s.match("</table>\\s*<p>")[0],h=s.split(o)
s="<p>"+h[1].split("</p>")[0].replace("<p>","").replace(/\/mediawiki\/index.php\//g,"http://en.wikipedia.org/wiki/").replace(/<a/g,'<a target="_blank"'),desc=$("<p></p>").append($(s))
var g=desc.html(),w=0,f=!1,k=""
for(c=0;c<g.length;c++){if("<"===g[c]&&(f=!0),f||(w+=1),k+=g[c],w>400){var x=k.split(" ")
k=x.slice(0,x.length-2).join(" "),k+="<b>...</b>"
break}f&&">"===g[c]&&(f=!1)}desc=$(k),l.addClass("module"),l.css({"margin-top":"20px",border:"0px"}),l.attr("id","wiki"),$("#wikiMain > div > .search_info").html(desc),window.InfoBox=l}else{var s=$(t.split("<p>")[1].replace("</p>","").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\/mediawiki\/index.php\//g,"http://en.wikipedia.org/wiki/").replace(/<a/g,'<a target="_blank"').trim())
desc=$("<p></p>").append($(s)),l=$(),window.InfoBox=l,$("#wikiMain > div > .search_info").append(desc)}$("#wikiMain > div > .search_info>a").on("click",function(e){e.stopPropagation()})})
